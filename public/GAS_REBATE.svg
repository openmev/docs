<svg
  id="mermaid-1617207830197"
  width="100%"
  xmlns="http://www.w3.org/2000/svg"
  height="887"
  style="max-width: 915px;"
  viewBox="-50 -10 915 887"
><style
  >#mermaid-1617207830197{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1617207830197 .error-icon{fill:#552222;}#mermaid-1617207830197 .error-text{fill:#552222;stroke:#552222;}#mermaid-1617207830197 .edge-thickness-normal{stroke-width:2px;}#mermaid-1617207830197 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1617207830197 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1617207830197 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1617207830197 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1617207830197 .marker{fill:#333333;stroke:#333333;}#mermaid-1617207830197 .marker.cross{stroke:#333333;}#mermaid-1617207830197 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1617207830197 .actor{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1617207830197 text.actor &gt; tspan{fill:black;stroke:none;}#mermaid-1617207830197 .actor-line{stroke:grey;}#mermaid-1617207830197 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mermaid-1617207830197 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mermaid-1617207830197 #arrowhead path{fill:#333;stroke:#333;}#mermaid-1617207830197 .sequenceNumber{fill:white;}#mermaid-1617207830197 #sequencenumber{fill:#333;}#mermaid-1617207830197 #crosshead path{fill:#333;stroke:#333;}#mermaid-1617207830197 .messageText{fill:#333;stroke:#333;}#mermaid-1617207830197 .labelBox{stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:#ECECFF;}#mermaid-1617207830197 .labelText,#mermaid-1617207830197 .labelText &gt; tspan{fill:black;stroke:none;}#mermaid-1617207830197 .loopText,#mermaid-1617207830197 .loopText &gt; tspan{fill:black;stroke:none;}#mermaid-1617207830197 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243,59.7765363128%,87.9019607843%);fill:hsl(259.6261682243,59.7765363128%,87.9019607843%);}#mermaid-1617207830197 .note{stroke:#aaaa33;fill:#fff5ad;}#mermaid-1617207830197 .noteText,#mermaid-1617207830197 .noteText &gt; tspan{fill:black;stroke:none;}#mermaid-1617207830197 .activation0{fill:#f4f4f4;stroke:#666;}#mermaid-1617207830197 .activation1{fill:#f4f4f4;stroke:#666;}#mermaid-1617207830197 .activation2{fill:#f4f4f4;stroke:#666;}#mermaid-1617207830197:root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-1617207830197 sequence{fill:apa;}</style><g
  /><g><line
      id="actor0"
      x1="75"
      y1="5"
      x2="75"
      y2="876"
      class="actor-line"
      stroke-width="0.5px"
      stroke="#999"
    /><rect
      x="0"
      y="0"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="75"
      y="32.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="75" dy="0">Eth Client</tspan></text></g><g><line
      id="actor1"
      x1="341"
      y1="5"
      x2="341"
      y2="876"
      class="actor-line"
      stroke-width="0.5px"
      stroke="#999"
    /><rect
      x="266"
      y="0"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="341"
      y="32.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="341" dy="0">Arbitrage Engine</tspan></text></g><g><line
      id="actor2"
      x1="735"
      y1="5"
      x2="735"
      y2="876"
      class="actor-line"
      stroke-width="0.5px"
      stroke="#999"
    /><rect
      x="660"
      y="0"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="735"
      y="32.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="735" dy="0">Profit Distributor</tspan></text></g><defs><marker
      id="arrowhead"
      refX="9"
      refY="5"
      markerUnits="userSpaceOnUse"
      markerWidth="12"
      markerHeight="12"
      orient="auto"
    ><path d="M 0 0 L 10 5 L 0 10 z" /></marker></defs><defs><marker
      id="crosshead"
      markerWidth="15"
      markerHeight="8"
      orient="auto"
      refX="16"
      refY="4"
    ><path
        fill="black"
        stroke="#000000"
        stroke-width="1px"
        d="M 9,2 V 6 L16,4 Z"
        style="stroke-dasharray: 0, 0;"
      /><path
        fill="none"
        stroke="#000000"
        stroke-width="1px"
        d="M 0,1 L 6,7 M 6,1 L 0,7"
        style="stroke-dasharray: 0, 0;"
      /></marker></defs><defs><marker
      id="filled-head"
      refX="18"
      refY="7"
      markerWidth="20"
      markerHeight="28"
      orient="auto"
    ><path d="M 18,7 L9,13 L14,7 L9,1 Z" /></marker></defs><defs><marker
      id="sequencenumber"
      refX="15"
      refY="15"
      markerWidth="60"
      markerHeight="40"
      orient="auto"
    ><circle cx="15" cy="15" r="6" /></marker></defs><text
    x="208"
    y="80"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >Chain state for latest block</text><line
    x1="75"
    y1="113"
    x2="341"
    y2="113"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="75"
    y="117"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >1</text><g /><text
    x="346"
    y="128"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >Analyze txs + receipts</text><path
    d="M 346,161 C 406,151 406,191 346,181"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="346"
    y="165"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >2</text><g /><g><rect
      x="257"
      y="201"
      fill="#EDF2AE"
      stroke="#666"
      width="168"
      height="36"
      rx="0"
      ry="0"
      class="note"
    /><text
      x="341"
      y="206"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="noteText"
      dy="1em"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"
    ><tspan x="341">Looking for our bundles</tspan></text></g><text
    x="351"
    y="342"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >Evalute tx status</text><path
    d="M 351,375 C 411,365 411,405 351,395"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="351"
    y="379"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >3</text><g /><text
    x="546"
    y="510"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >Request to refund part of the gas to the User</text><line
    x1="356"
    y1="543"
    x2="735"
    y2="543"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="356"
    y="547"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >4</text><g /><g><rect
      x="316"
      y="553"
      fill="#EDF2AE"
      stroke="#666"
      width="444"
      height="36"
      rx="0"
      ry="0"
      class="note"
    /><text
      x="538"
      y="558"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="noteText"
      dy="1em"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"
    ><tspan
        x="538"
      >It may be more efficient to batch up refunds etc.</tspan></text></g><g
  ><line x1="306" y1="415" x2="770" y2="415" class="loopLine" /><line
      x1="770"
      y1="415"
      x2="770"
      y2="599"
      class="loopLine"
    /><line x1="306" y1="599" x2="770" y2="599" class="loopLine" /><line
      x1="306"
      y1="415"
      x2="306"
      y2="599"
      class="loopLine"
    /><line
      x1="306"
      y1="465"
      x2="770"
      y2="465"
      class="loopLine"
      style="stroke-dasharray: 3, 3;"
    /><polygon
      points="306,415 356,415 356,428 347.6,435 306,435"
      class="labelBox"
    /><text
      x="331"
      y="428"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="labelText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    >alt</text><text
      x="563"
      y="433"
      text-anchor="middle"
      class="loopText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    ><tspan x="563">[Tx reverted]</tspan></text><text
      x="538"
      y="483"
      text-anchor="middle"
      class="loopText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    >[Tx success]</text></g><g><line
      x1="266"
      y1="292"
      x2="780"
      y2="292"
      class="loopLine"
    /><line x1="780" y1="292" x2="780" y2="609" class="loopLine" /><line
      x1="266"
      y1="609"
      x2="780"
      y2="609"
      class="loopLine"
    /><line x1="266" y1="292" x2="266" y2="609" class="loopLine" /><polygon
      points="266,292 316,292 316,305 307.6,312 266,312"
      class="labelBox"
    /><text
      x="291"
      y="305"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="labelText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    >loop</text><text
      x="548"
      y="310"
      text-anchor="middle"
      class="loopText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    ><tspan x="548">[Each tx]</tspan></text></g><g><line
      x1="256"
      y1="247"
      x2="790"
      y2="247"
      class="loopLine"
    /><line x1="790" y1="247" x2="790" y2="619" class="loopLine" /><line
      x1="256"
      y1="619"
      x2="790"
      y2="619"
      class="loopLine"
    /><line x1="256" y1="247" x2="256" y2="619" class="loopLine" /><polygon
      points="256,247 306,247 306,260 297.6,267 256,267"
      class="labelBox"
    /><text
      x="281"
      y="260"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="labelText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    >loop</text><text
      x="548"
      y="265"
      text-anchor="middle"
      class="loopText"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
    ><tspan x="548">[Each bundle that we identify]</tspan></text></g><text
    x="740"
    y="634"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >wait n confirmations</text><path
    d="M 740,667 C 800,657 800,697 740,687"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="740"
    y="671"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >5</text><g /><text
    x="403"
    y="712"
    text-anchor="middle"
    dominant-baseline="middle"
    alignment-baseline="middle"
    class="messageText"
    dy="1em"
    style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 16px; font-weight: 400;"
  >A series of txs for refunding gas to Users</text><line
    x1="730"
    y1="745"
    x2="75"
    y2="745"
    class="messageLine0"
    stroke-width="2"
    stroke="none"
    marker-end="url(#arrowhead)"
    marker-start="url(#sequencenumber)"
    style="fill: none;"
  /><text
    x="730"
    y="749"
    font-family="sans-serif"
    font-size="12px"
    text-anchor="middle"
    textLength="16px"
    class="sequenceNumber"
  >6</text><g /><g><rect
      x="50"
      y="755"
      fill="#EDF2AE"
      stroke="#666"
      width="710"
      height="36"
      rx="0"
      ry="0"
      class="note"
    /><text
      x="405"
      y="760"
      text-anchor="middle"
      dominant-baseline="middle"
      alignment-baseline="middle"
      class="noteText"
      dy="1em"
      style="font-family: &quot;trebuchet ms&quot;, verdana, arial, sans-serif; font-size: 14px; font-weight: 400;"
    ><tspan
        x="405"
      >If User refund is ever something other than Ether, perhaps the MEV relay would be better for this</tspan></text></g><g
  ><rect
      x="0"
      y="811"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="75"
      y="843.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="75" dy="0">Eth Client</tspan></text></g><g><rect
      x="266"
      y="811"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="341"
      y="843.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="341" dy="0">Arbitrage Engine</tspan></text></g><g><rect
      x="660"
      y="811"
      fill="#eaeaea"
      stroke="#666"
      width="150"
      height="65"
      rx="3"
      ry="3"
      class="actor"
    /><text
      x="735"
      y="843.5"
      dominant-baseline="central"
      alignment-baseline="central"
      class="actor"
      style="text-anchor: middle; font-size: 14px; font-weight: 400; font-family: Open-Sans, sans-serif;"
    ><tspan x="735" dy="0">Profit Distributor</tspan></text></g></svg>
