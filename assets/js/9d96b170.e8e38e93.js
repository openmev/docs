"use strict";(self.webpackChunkopenmev_docs=self.webpackChunkopenmev_docs||[]).push([[106],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>k});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=c(a),k=r,N=m["".concat(l,".").concat(k)]||m[k]||d[k]||o;return a?n.createElement(N,i(i({ref:t},p),{},{components:a})):n.createElement(N,i({ref:t},p))}));function k(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=a[c];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},7845:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var n=a(3117),r=(a(7294),a(3905));const o={sidebar_position:4,title:"Chain Reorgs and Errors"},i=void 0,s={unversionedId:"technical-reference/chain-errors",id:"technical-reference/chain-errors",title:"Chain Reorgs and Errors",description:"Status Message Error Decoding",source:"@site/docs/technical-reference/chain-errors.md",sourceDirName:"technical-reference",slug:"/technical-reference/chain-errors",permalink:"/technical-reference/chain-errors",editUrl:"https://github.com/openmev/docs/edit/main/docs/technical-reference/chain-errors.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,title:"Chain Reorgs and Errors"},sidebar:"tutorialSidebar",previous:{title:"Transaction Rebating",permalink:"/technical-reference/rebates"},next:{title:"Latency Benchmarking",permalink:"/technical-reference/benchmarking"}},l={},c=[{value:"Status Message Error Decoding",id:"status-message-error-decoding",level:2},{value:"Chain Reorgs",id:"chain-reorgs",level:3}],p={toc:c};function d(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"status-message-error-decoding"},"Status Message Error Decoding"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"center"},(0,r.kt)("strong",{parentName:"th"},"HandleId")),(0,r.kt)("th",{parentName:"tr",align:"center"},(0,r.kt)("strong",{parentName:"th"},"Status Message")),(0,r.kt)("th",{parentName:"tr",align:"center"},(0,r.kt)("strong",{parentName:"th"},"Description")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"2"),(0,r.kt)("td",{parentName:"tr",align:"center"},"QUEUED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"The default state when initially creating a transaction during the initial API call","."," This indicates that this transaction is waiting to be picked up by a background worker",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"3"),(0,r.kt)("td",{parentName:"tr",align:"center"},"PROCESSING"),(0,r.kt)("td",{parentName:"tr",align:"center"},"A background worker has started to process this transaction",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"4"),(0,r.kt)("td",{parentName:"tr",align:"center"},"FUNDING"),(0,r.kt)("td",{parentName:"tr",align:"center"},"An auxiliary funding transaction is being initiated ","(","this only applies to non","-","Ether transactions",")",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"5"),(0,r.kt)("td",{parentName:"tr",align:"center"},"FUNDED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"An auxiliary funding transaction was successful ","(","this only applies to non","-","Ether transactions",")",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"6"),(0,r.kt)("td",{parentName:"tr",align:"center"},"BROADCASTING"),(0,r.kt)("td",{parentName:"tr",align:"center"},"The transaction is being announced to the blockchain network nodes",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"7"),(0,r.kt)("td",{parentName:"tr",align:"center"},"BROADCASTED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"The transaction was successfully announced to the blockchain network nodes",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"8"),(0,r.kt)("td",{parentName:"tr",align:"center"},"PENDING"),(0,r.kt)("td",{parentName:"tr",align:"center"},'The transaction is "pending" / "in the mempool", i',".","e","."," known to ","(","some",")"," blockchain network nodes, and awaiting inclusion/mining into a block",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"9"),(0,r.kt)("td",{parentName:"tr",align:"center"},"CONFIRMING"),(0,r.kt)("td",{parentName:"tr",align:"center"},'The transaction was mined into a block, but not enough subsequent blocks have yet been mined to consider that transaction "safe" / confirmed',".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"10"),(0,r.kt)("td",{parentName:"tr",align:"center"},"CONFIRMED"),(0,r.kt)("td",{parentName:"tr",align:"center"},'The transaction was mined into a block and enough subsequent blocks have been mined to consider that transaction "safe" / confirmed',".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"11"),(0,r.kt)("td",{parentName:"tr",align:"center"},"FAILED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"The transaction was mined into a block, but the execution of its smart contract code failed",".",' Several reasons are possible, most notably "out of gas"',"."," The transaction is still included in a block because its gas is still awarded to the miner who attempted to execute it",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"12"),(0,r.kt)("td",{parentName:"tr",align:"center"},"REJECTED"),(0,r.kt)("td",{parentName:"tr",align:"center"},"The transaction was mined into a block but was rejected during the execution of its smart contract code","."," Several reasons are possible, most notably Solidity's require","(",")"," assertions not being satisfied","."," The transaction is still included in a block because it's gas is still awarded to the miner who attempted to execute it",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"13"),(0,r.kt)("td",{parentName:"tr",align:"center"},"UN-PROCESSABLE"),(0,r.kt)("td",{parentName:"tr",align:"center"},"An unrecoverable error occurred which prevents us from getting this transaction onto the blockchain","."," We have given up ","(","or the customer requested us not to retry",")",".")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:"center"},"14"),(0,r.kt)("td",{parentName:"tr",align:"center"},"RETRYING"),(0,r.kt)("td",{parentName:"tr",align:"center"},"A temporary/recoverable error occurred, and this transaction was re","-","queued as to try getting this transaction onto the blockchain at a later time","."," This state is more or less equivalent to QUEUED, but its name is more telling",".")))),(0,r.kt)("h3",{id:"chain-reorgs"},"Chain Reorgs"),(0,r.kt)("p",null,"We need to detect re-orgs. Each time re query for a block we should have a reference for what we expect the parent hash to be. A re-org is detected when the retrieved block's parent hash does not match the expected parent hash. Next we need to add some metadata to how the Exfiltrator sends data to the Loader. Instead of passing raw blocks we should do something like this:"),(0,r.kt)("div",{className:"shiki-twoslash-fragment"},(0,r.kt)("pre",{parentName:"div",className:"shiki min-light",style:{backgroundColor:"#ffffff",color:"#24292eff"}},(0,r.kt)("div",{parentName:"pre",className:"language-id"},"python"),(0,r.kt)("div",{parentName:"pre",className:"code-container"},(0,r.kt)("code",{parentName:"div"},(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#D32F2F"}},"class"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#6F42C1"}},"ChainSegment"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}},"("),(0,r.kt)("span",{parentName:"div",style:{color:"#6F42C1"}},"NamedTuple"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}},"):")),(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}},"    blocks"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},":"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," Tuple"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},"["),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}},"Block"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},","),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," ..."),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},"]")),(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}},"    is_reorg"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},":"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#1976D2"}},"bool"),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#D32F2F"}},"="),(0,r.kt)("span",{parentName:"div",style:{color:"#24292EFF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#1976D2"}},"False")),(0,r.kt)("div",{parentName:"code",className:"line"})))),(0,r.kt)("pre",{parentName:"div",className:"shiki nord",style:{backgroundColor:"#2e3440ff",color:"#d8dee9ff"}},(0,r.kt)("div",{parentName:"pre",className:"language-id"},"python"),(0,r.kt)("div",{parentName:"pre",className:"code-container"},(0,r.kt)("code",{parentName:"div"},(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#81A1C1"}},"class"),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#8FBCBB"}},"ChainSegment"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"("),(0,r.kt)("span",{parentName:"div",style:{color:"#8FBCBB"}},"NamedTuple"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"):")),(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}},"    blocks"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},":"),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," Tuple"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"["),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}},"Block"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},","),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," ..."),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"]")),(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}},"    is_reorg"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},":"),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#88C0D0"}},"bool"),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#81A1C1"}},"="),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#81A1C1"}},"False")),(0,r.kt)("div",{parentName:"code",className:"line"}))))),(0,r.kt)("p",null,"For the normal case, the exfiltrator would transmit"),(0,r.kt)("div",{className:"shiki-twoslash-fragment"},(0,r.kt)("pre",{parentName:"div",className:"shiki min-light",style:{backgroundColor:"#ffffff",color:"#24292eff"}},(0,r.kt)("div",{parentName:"pre",className:"language-id"},"python"),(0,r.kt)("div",{parentName:"pre",className:"code-container"},(0,r.kt)("code",{parentName:"div"},(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#6F42C1"}},"ChainSegment"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},"(blocks"),(0,r.kt)("span",{parentName:"div",style:{color:"#D32F2F"}},"="),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},"(next_block,), is_reorg"),(0,r.kt)("span",{parentName:"div",style:{color:"#D32F2F"}},"="),(0,r.kt)("span",{parentName:"div",style:{color:"#1976D2"}},"False"),(0,r.kt)("span",{parentName:"div",style:{color:"#212121"}},")."))))),(0,r.kt)("pre",{parentName:"div",className:"shiki nord",style:{backgroundColor:"#2e3440ff",color:"#d8dee9ff"}},(0,r.kt)("div",{parentName:"pre",className:"language-id"},"python"),(0,r.kt)("div",{parentName:"pre",className:"code-container"},(0,r.kt)("code",{parentName:"div"},(0,r.kt)("div",{parentName:"code",className:"line"},(0,r.kt)("span",{parentName:"div",style:{color:"#88C0D0"}},"ChainSegment"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"("),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9"}},"blocks"),(0,r.kt)("span",{parentName:"div",style:{color:"#81A1C1"}},"="),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},"("),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}},"next_block"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},",),"),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9FF"}}," "),(0,r.kt)("span",{parentName:"div",style:{color:"#D8DEE9"}},"is_reorg"),(0,r.kt)("span",{parentName:"div",style:{color:"#81A1C1"}},"=False"),(0,r.kt)("span",{parentName:"div",style:{color:"#ECEFF4"}},").")))))),(0,r.kt)("p",null,"In the case that a reorg has been encountered it would trace backwards up the parent_hash links until it encounters a previously known block. The exfiltrator would transmit ChainSegment(blocks=new_chain_segment, is_reorg=True). We can bound re-org detection to a fixed maximum size window and error out if tracing backwards up the chain exceeds this limit."))}d.isMDXComponent=!0}}]);